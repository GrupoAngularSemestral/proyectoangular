<div class="export-page">
  <div class="export-container">
    <!-- Header -->
    <div class="export-header">
      <h1>ğŸ“Š Exportar Datos</h1>
      <p>Genera reportes profesionales de tu progreso para compartir con mÃ©dicos, nutricionistas o entrenadores personales.</p>
    </div>

    <!-- Loading State -->
    <div *ngIf="loading" class="loading">
      <div class="loading-spinner"></div>
      <p>{{ loadingMessage || 'Preparando exportaciÃ³n...' }}</p>
    </div>

    <!-- Error State -->
    <div *ngIf="error && !loading" class="error-message">
      <p>âŒ {{ error }}</p>
      <button class="btn-retry" (click)="cargarDatos()">Reintentar</button>
    </div>

    <!-- Filtros -->
    <div *ngIf="!loading && !error" class="export-filters">
      <h3>ğŸ“… PerÃ­odo de ExportaciÃ³n</h3>
      <div class="filter-options">
        <div class="filter-group">
          <label for="tipoFiltro">PerÃ­odo:</label>
          <select id="tipoFiltro" [(ngModel)]="filtros.tipoFiltro" (ngModelChange)="actualizarFiltroFecha()">
            <option value="todo">Todo el historial</option>
            <option value="ultimo-mes">Ãšltimo mes</option>
            <option value="ultimos-3-meses">Ãšltimos 3 meses</option>
            <option value="ultimo-semestre">Ãšltimo semestre</option>
            <option value="personalizado">Personalizado</option>
          </select>
        </div>
        
        <div *ngIf="filtros.tipoFiltro === 'personalizado'" class="filter-dates">
          <div class="form-group">
            <label for="desde">Desde:</label>
            <input type="date" id="desde" [(ngModel)]="filtros.desde">
          </div>
          <div class="form-group">
            <label for="hasta">Hasta:</label>
            <input type="date" id="hasta" [(ngModel)]="filtros.hasta">
          </div>
        </div>
      </div>
    </div>

    <!-- Contenido a exportar -->
    <div *ngIf="!loading && !error" class="export-content">
      <h3>ğŸ“‹ Contenido a Incluir</h3>
      <div class="content-options">
        <label class="checkbox-option">
          <input type="checkbox" [(ngModel)]="filtros.incluirHabitos">
          <span class="checkmark"></span>
          ğŸ“ HÃ¡bitos registrados
        </label>
        <label class="checkbox-option">
          <input type="checkbox" [(ngModel)]="filtros.incluirProgreso">
          <span class="checkmark"></span>
          ğŸ“ˆ Registros de progreso
        </label>
        <label class="checkbox-option">
          <input type="checkbox" [(ngModel)]="filtros.incluirLogros">
          <span class="checkmark"></span>
          ğŸ† Logros obtenidos
        </label>
        <label class="checkbox-option">
          <input type="checkbox" [(ngModel)]="filtros.incluirEstadisticas">
          <span class="checkmark"></span>
          ğŸ“Š EstadÃ­sticas y anÃ¡lisis
        </label>
      </div>
    </div>

    <!-- Vista previa -->
    <div *ngIf="!loading && !error && vistaPrevia" class="export-preview">
      <h3>ğŸ‘€ Vista Previa</h3>
      <div class="preview-stats">
        <div class="preview-stat">
          <strong>{{ vistaPrevia.totalHabitos }}</strong>
          <span>HÃ¡bitos</span>
        </div>
        <div class="preview-stat">
          <strong>{{ vistaPrevia.totalProgreso }}</strong>
          <span>Registros</span>
        </div>
        <div class="preview-stat">
          <strong>{{ vistaPrevia.totalLogros }}</strong>
          <span>Logros</span>
        </div>
        <div class="preview-stat">
          <strong>{{ vistaPrevia.porcentajeExito }}%</strong>
          <span>Ã‰xito</span>
        </div>
      </div>
    </div>

    <!-- Opciones de exportaciÃ³n -->
    <div *ngIf="!loading && !error" class="export-options">
      <h3>ğŸ’¾ Formato de ExportaciÃ³n</h3>
      <div class="export-buttons">
        <button 
          class="btn-export btn-pdf" 
          (click)="exportarPDF()"
          [disabled]="exportando || !puedeExportar">
          {{ exportando && tipoExportacion === 'pdf' ? 'â³ Generando...' : 'ğŸ“„ Exportar como PDF' }}
          <small>Reporte profesional para impresiÃ³n</small>
        </button>
        
        <button 
          class="btn-export btn-csv" 
          (click)="exportarCSV()"
          [disabled]="exportando || !puedeExportar">
          {{ exportando && tipoExportacion === 'csv' ? 'â³ Preparando...' : 'ğŸ“Š Exportar como CSV' }}
          <small>Datos estructurados para anÃ¡lisis</small>
        </button>
        
        <button 
          class="btn-export btn-json" 
          (click)="exportarJSON()"
          [disabled]="exportando || !puedeExportar">
          {{ exportando && tipoExportacion === 'json' ? 'â³ Preparando...' : 'ğŸ”§ Exportar como JSON' }}
          <small>Datos completos para desarrolladores</small>
        </button>
      </div>
      
      <div *ngIf="!puedeExportar" class="export-warning">
        âš ï¸ Selecciona al menos un tipo de contenido para exportar
      </div>
    </div>

    <!-- Mensaje de Ã©xito -->
    <div *ngIf="mensajeExito" class="success-message">
      âœ… {{ mensajeExito }}
    </div>
  </div>
</div>
